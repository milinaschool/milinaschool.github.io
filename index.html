<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©´ì ‘ ì—°ìŠµ í”„ë¡œê·¸ë¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: #f0ede8;
            min-height: 100vh;
            padding: 0;
            color: #1a1a1a;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #faf9f7;
            min-height: 100vh;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.08);
        }

        .header {
            background: #faf9f7;
            border-bottom: 1px solid #d8d4cf;
            padding: 24px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 1.5em;
            font-weight: 600;
            color: #1a1a1a;
            letter-spacing: -0.02em;
        }

        .tabs {
            display: flex;
            background: #faf9f7;
            border-bottom: 1px solid #d8d4cf;
            padding: 0 40px;
            gap: 2px;
        }

        .tab {
            padding: 14px 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95em;
            color: #6b7280;
            transition: all 0.2s ease;
            border: none;
            background: transparent;
            border-bottom: 2px solid transparent;
            position: relative;
        }

        .tab:hover {
            color: #374151;
            background: #f0ede8;
        }

        .tab.active {
            color: #c97f66;
            border-bottom-color: #c97f66;
            background: transparent;
        }

        .tab-content {
            display: none;
            padding: 32px 40px;
            background: #faf9f7;
        }

        .tab-content.active {
            display: block;
        }

        /* ì—°ìŠµ íƒ­ ìŠ¤íƒ€ì¼ */
        .practice-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        .question-section {
            background: #faf9f7;
            padding: 0;
        }

        .category-selector {
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .category-selector label {
            font-weight: 500;
            color: #374151;
            font-size: 0.95em;
        }

        .category-selector select {
            padding: 8px 12px;
            border: 1px solid #d8d4cf;
            border-radius: 6px;
            font-size: 0.95em;
            cursor: pointer;
            background: white;
            color: #1a1a1a;
            transition: border-color 0.2s;
        }

        .category-selector select:focus {
            outline: none;
            border-color: #c97f66;
            box-shadow: 0 0 0 3px rgba(201, 127, 102, 0.1);
        }

        .question-display {
            background: white;
            padding: 24px;
            border-radius: 8px;
            margin: 20px 0;
            min-height: 150px;
            border: 1px solid #e8e5e0;
        }

        .question-number {
            color: #6b7280;
            font-weight: 500;
            font-size: 0.85em;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .question-text {
            font-size: 1.25em;
            color: #1a1a1a;
            line-height: 1.6;
            font-weight: 500;
        }

        .controls {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: #c97f66;
            color: white;
        }

        .btn-primary:hover {
            background: #b86f58;
        }

        .btn-record {
            background: #a85b47;
            color: white;
            font-size: 1em;
            padding: 12px 24px;
        }

        .btn-record:hover {
            background: #924d3a;
        }

        .btn-record.recording {
            background: #7c9473;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .btn-secondary {
            background: #e8e5e0;
            color: #374151;
            border: 1px solid #d8d4cf;
        }

        .btn-secondary:hover {
            background: #d8d4cf;
        }

        .btn-success {
            background: #7c9473;
            color: white;
        }

        .btn-success:hover {
            background: #6b8064;
        }

        .btn-danger {
            background: #c97f66;
            color: white;
        }

        .btn-danger:hover {
            background: #b86f58;
        }

        .btn-small {
            padding: 6px 14px;
            font-size: 0.875em;
        }
        
        .btn-icon {
             padding: 6px 8px;
             font-size: 0.8em;
             line-height: 1;
        }


        .timer {
            background: #f5e6d3;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 1.5em;
            font-weight: 600;
            color: #8b5a3c;
            text-align: center;
            margin: 20px 0;
            border: 1px solid #e8d5bc;
        }

        .transcription-area {
            background: white;
            border: 1px solid #e8e5e0;
            border-radius: 8px;
            padding: 20px;
            min-height: 150px;
            margin: 20px 0;
        }

        .transcription-area h3 {
            font-size: 0.95em;
            color: #6b7280;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .transcription-text {
            width: 100%;
            min-height: 200px;
            border: 1px solid #e8e5e0;
            border-radius: 6px;
            padding: 12px;
            font-size: 0.95em;
            font-family: inherit;
            resize: vertical;
            background: white;
        }

        .transcription-text:focus {
            outline: none;
            border-color: #c97f66;
            box-shadow: 0 0 0 3px rgba(201, 127, 102, 0.1);
        }

        .history-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e8e5e0;
        }

        .history-panel h2 {
            font-size: 1.1em;
            margin-bottom: 16px;
            color: #1a1a1a;
            font-weight: 600;
        }

        .answer-card {
            background: #faf9f7;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 12px;
            border: 1px solid #e8e5e0;
        }

        .answer-question {
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .answer-meta {
            font-size: 0.85em;
            color: #6b7280;
            margin-bottom: 12px;
        }

        .answer-text {
            color: #374151;
            font-size: 0.9em;
            line-height: 1.6;
            margin-bottom: 12px;
            white-space: pre-wrap;
        }

        .answer-actions {
            display: flex;
            gap: 8px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        /* ì§ˆë¬¸ ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
        .manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .manager-header h2 {
            font-size: 1.5em;
            color: #1a1a1a;
            font-weight: 600;
        }

        .manager-controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .file-input-wrapper input[type="file"] {
            display: none;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e8e5e0;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 600;
            color: #c97f66;
            margin-bottom: 4px;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.9em;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d8d4cf;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .search-box input:focus {
            outline: none;
            border-color: #c97f66;
            box-shadow: 0 0 0 3px rgba(201, 127, 102, 0.1);
        }

        .management-section {
            background: white;
            padding: 24px;
            border-radius: 8px;
            border: 1px solid #e8e5e0;
            margin-bottom: 24px;
        }

        .management-header {
            margin-bottom: 20px;
        }

        .management-header h3 {
            font-size: 1.25em;
            margin-bottom: 8px;
            color: #1a1a1a;
            font-weight: 600;
        }

        .management-header p {
            font-size: 0.9em;
            color: #6b7280;
        }

        #category-list-new {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .category-list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: #faf9f7;
            border: 1px solid #e8e5e0;
            border-radius: 6px;
        }

        .category-info-new {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .category-name-badge {
            font-weight: 500;
            padding: 4px 12px;
            background: white;
            border: 1px solid #d8d4cf;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .question-count-badge {
            font-size: 0.9em;
            color: #6b7280;
        }

        .accordion-item {
            border: 1px solid #e8e5e0;
            border-radius: 6px;
            margin-bottom: 12px;
            overflow: hidden;
        }

        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #faf9f7;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .accordion-header:hover {
            background: #f0ede8;
        }
        
        .accordion-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            color: #1a1a1a;
            flex: 1;
            overflow: hidden;
        }
        
        .accordion-header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-icon {
            transition: transform 0.3s ease;
            font-size: 0.8em;
        }

        .accordion-header.active .toggle-icon {
            transform: rotate(90deg);
        }

        .accordion-content {
            display: none;
            padding: 16px;
            background: white;
            border-top: 1px solid #e8e5e0;
        }

        .question-list-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0ede8;
        }
        .question-list-item:last-child {
            border-bottom: none;
        }

        .question-number-new {
            color: #6b7280;
            font-size: 0.9em;
            width: 30px;
        }

        .question-text-view {
            flex: 1;
            color: #374151;
        }

        .inline-add-form {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px dashed #d8d4cf;
        }

        .inline-add-form input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d8d4cf;
            border-radius: 6px;
            font-size: 0.95em;
        }
        .inline-add-form input:focus {
            outline: none;
            border-color: #c97f66;
            box-shadow: 0 0 0 3px rgba(201, 127, 102, 0.1);
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            padding: 24px 24px 16px;
            border-bottom: 1px solid #e8e5e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.25em;
            font-weight: 600;
            color: #1a1a1a;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            color: #6b7280;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        .close-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .modal form {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d8d4cf;
            border-radius: 6px;
            font-size: 0.95em;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #c97f66;
            box-shadow: 0 0 0 3px rgba(201, 127, 102, 0.1);
        }

        .status-message {
            padding: 12px 16px;
            border-radius: 6px;
            margin: 15px 0;
            font-weight: 500;
            font-size: 0.95em;
        }

        .status-info {
            background: #e8f0f5;
            color: #2c5f7a;
            border: 1px solid #c5dae8;
        }

        .status-success {
            background: #e8f2e5;
            color: #4a6b42;
            border: 1px solid #c5ddc0;
        }

        .status-error {
            background: #f5e6e0;
            color: #8b5a3c;
            border: 1px solid #e8d5bc;
        }

        .warning-box {
            background: #fef3c7;
            border: 1px solid #fde68a;
            padding: 16px;
            border-radius: 6px;
            margin: 20px 40px 0;
            color: #92400e;
            font-size: 0.9em;
        }
        .warning-box code {
            background: #fff;
            padding: 2px 8px;
            border-radius: 4px;
            color: #333;
        }

        @media (max-width: 768px) {
            .practice-layout {
                grid-template-columns: 1fr;
            }

            .tabs {
                overflow-x: auto;
                padding: 0 20px;
            }

            .tab {
                white-space: nowrap;
            }

            .manager-header {
                flex-direction: column;
                align-items: stretch;
            }

            .manager-controls {
                width: 100%;
            }

            .manager-controls button {
                flex: 1;
            }
        }
        
        /* ì§‘ì¤‘ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        #focusModeContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            color: white;
            z-index: 2000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            padding: 40px;
        }

        #focusModeContainer.active {
            display: flex;
            opacity: 1;
        }

        .focus-controls-top {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 12px;
        }

        #focusCategorySelect, #exitFocusBtn {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
        }

        #focus-question-text {
            font-size: 2em;
            font-weight: 500;
            max-width: 800px;
            margin-bottom: 40px;
            min-height: 100px;
        }

        #focus-circle {
            width: 150px;
            height: 150px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s ease-out, background-color 0.3s ease, border 0.3s ease;
            box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4);
        }

        #focus-circle:hover {
            transform: scale(1.05);
        }

        #focus-circle.waiting {
            animation: pulse-white 2s infinite;
        }

        #focus-circle.listening {
            background-color: #ffcdd2; /* ë¶‰ì€ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
            border: 2px solid #e57373;   /* í…Œë‘ë¦¬ ì¶”ê°€ */
        }

        @keyframes pulse-white {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }

        #focus-status-text {
            margin-top: 30px;
            font-size: 1.1em;
            color: #aaa;
            height: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ ë©´ì ‘ ì—°ìŠµ í”„ë¡œê·¸ë¨</h1>
        </div>
        
        <div id="setupWarning" class="warning-box" style="display: none;">
            <strong>âš ï¸ ìŒì„± ì¸ì‹ì„ ì‚¬ìš©í•˜ë ¤ë©´ ë¡œì»¬ ì„œë²„ ë˜ëŠ” HTTPSê°€ í•„ìš”í•©ë‹ˆë‹¤!</strong><br>
            í˜„ì¬ <code>file://</code> í”„ë¡œí† ì½œë¡œ ì‹¤í–‰ ì¤‘ì´ì–´ì„œ ìŒì„± ì¸ì‹ì´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
            <em>â€» ìŒì„± ì¸ì‹ ì—†ì´ í…ìŠ¤íŠ¸ë§Œ ì…ë ¥í•´ì„œ ì‚¬ìš©í•˜ì…”ë„ ë©ë‹ˆë‹¤.</em>
        </div>

        <div style="padding: 12px 40px; margin: 0; display: none;" id="recognitionStatusBar">
            <div style="display: flex; align-items: center; gap: 10px; padding: 8px 12px; border-radius: 6px; border-left: 4px solid;">
                <span id="recognitionStatusIcon" style="font-size: 1.2em;"></span>
                <span id="recognitionStatusText" style="font-weight: 500;"></span>
            </div>
        </div>


        <div class="tabs">
            <button class="tab active" onclick="switchTab('practice')">ì—°ìŠµ</button>
            <button class="tab" onclick="switchTab('questions')">ì§ˆë¬¸ ë°ì´í„°ë² ì´ìŠ¤</button>
            <button class="tab" onclick="switchTab('answers')">ë‹µë³€ ê¸°ë¡</button>
            <button class="tab" onclick="switchTab('stats')">í†µê³„</button>
        </div>

        <!-- ì—°ìŠµ íƒ­ -->
        <div id="practice-tab" class="tab-content active">
            <div class="practice-layout">
                <div class="question-section">
                    <div class="category-selector">
                        <label>ì¹´í…Œê³ ë¦¬:</label>
                        <select id="categorySelect">
                            <option value="all">ì „ì²´</option>
                        </select>
                    </div>

                    <div class="question-display" id="questionDisplay">
                        <div class="question-number">ì§ˆë¬¸ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
                        <div class="question-text">"ìƒˆ ì§ˆë¬¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</div>
                    </div>

                    <div class="controls">
                        <button class="btn-primary" onclick="getNewQuestion()">ìƒˆ ì§ˆë¬¸</button>
                        <button class="btn-record" id="recordBtn" onclick="toggleRecording()">ë…¹ìŒ ì‹œì‘</button>
                        <button class="btn-secondary" onclick="resetTimer()">íƒ€ì´ë¨¸ ë¦¬ì…‹</button>
                    </div>

                    <div class="timer" id="timer">00:00</div>

                    <div class="transcription-area">
                        <h3>ë‹µë³€ ë‚´ìš© (ìˆ˜ì • ê°€ëŠ¥)</h3>
                        <textarea class="transcription-text" id="transcriptionText" placeholder="ë…¹ìŒì„ ì‹œì‘í•˜ë©´ ì—¬ê¸°ì— í…ìŠ¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
                    </div>

                    <div class="controls">
                        <button class="btn-success" onclick="saveAnswer()">ë‹µë³€ ì €ì¥</button>
                        <button class="btn-secondary" onclick="clearTranscription()">ë‚´ìš© ì§€ìš°ê¸°</button>
                    </div>

                    <div id="statusMessage"></div>
                </div>

                <div class="history-panel">
                    <h2>ìµœê·¼ ë‹µë³€ (5ê°œ)</h2>
                    <div id="recentAnswers"></div>
                </div>
            </div>
        </div>

        <!-- ì§ˆë¬¸ ê´€ë¦¬ íƒ­ -->
        <div id="questions-tab" class="tab-content">
            <div class="manager-header">
                <h2>ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬</h2>
                <div class="manager-controls">
                    <button class="btn-secondary" onclick="exportDatabase()">DB ë‚´ë³´ë‚´ê¸°</button>
                    <div class="file-input-wrapper">
                        <input type="file" id="dbImportFile" accept=".json" onchange="importDatabase(event)">
                        <button class="btn-secondary" onclick="document.getElementById('dbImportFile').click()">DB ê°€ì ¸ì˜¤ê¸°</button>
                    </div>
                </div>
            </div>
            
            <div class="management-section">
                <div class="management-header">
                    <h3>ğŸ“‚ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h3>
                    <p>ëª¨ë“  ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì— ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤. ì¹´í…Œê³ ë¦¬ë¥¼ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•˜ì—¬ ì§ˆë¬¸ì„ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”.</p>
                </div>
                <div id="category-list-new">
                    <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì¹´í…Œê³ ë¦¬ ëª©ë¡ì´ ìƒì„±ë©ë‹ˆë‹¤. -->
                </div>
                <button class="btn-primary" onclick="openAddCategoryModal()">+ ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</button>
            </div>

            <div class="management-section">
                <div class="management-header">
                    <h3>ğŸ“š ì§ˆë¬¸ ê´€ë¦¬</h3>
                    <p>ê° ì¹´í…Œê³ ë¦¬ë¥¼ í´ë¦­í•˜ì—¬ í¼ì¹˜ê±°ë‚˜ ì ‘ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì§ˆë¬¸ ë°ì´í„°ë¥¼ ë‚´ë³´ë‚´ê±°ë‚˜ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                <div id="question-accordion-list">
                    <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì•„ì½”ë””ì–¸ ëª©ë¡ì´ ìƒì„±ë©ë‹ˆë‹¤. -->
                </div>
            </div>
        </div>

        <!-- ë‹µë³€ ê´€ë¦¬ íƒ­ -->
        <div id="answers-tab" class="tab-content">
            <div class="answer-manager">
                <div class="manager-header">
                    <h2>ë‹µë³€ ê¸°ë¡ ê´€ë¦¬</h2>
                    <div class="manager-controls">
                        <button class="btn-primary" onclick="exportAnswers()">ë‹µë³€ ë‚´ë³´ë‚´ê¸°</button>
                        <div class="file-input-wrapper">
                            <input type="file" id="answerImportFile" accept=".json" onchange="importAnswers(event)">
                            <button class="btn-secondary" onclick="document.getElementById('answerImportFile').click()">ë‹µë³€ ê°€ì ¸ì˜¤ê¸°</button>
                        </div>
                        <button class="btn-danger" onclick="clearAllAnswers()">ì „ì²´ ì‚­ì œ</button>
                    </div>
                </div>

                <div class="search-box">
                    <input type="text" id="answerSearch" placeholder="ë‹µë³€ ê²€ìƒ‰..." oninput="filterAnswers()">
                </div>

                <div id="answerList"></div>
            </div>
        </div>

        <!-- í†µê³„ íƒ­ -->
        <div id="stats-tab" class="tab-content">
            <h2 style="margin-bottom: 24px; font-size: 1.5em;">ğŸ“Š ì—°ìŠµ í†µê³„</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="statsQuestionsCount">0</div>
                    <div class="stat-label">ì „ì²´ ì§ˆë¬¸ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statsCategoryCount">0</div>
                    <div class="stat-label">ì¹´í…Œê³ ë¦¬ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statsAnswersCount">0</div>
                    <div class="stat-label">ì €ì¥ëœ ë‹µë³€</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statsPracticeTime">0</div>
                    <div class="stat-label">ì´ ì—°ìŠµ ì‹œê°„ (ë¶„)</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì§ˆë¬¸ ì¶”ê°€/í¸ì§‘ ëª¨ë‹¬ -->
    <div id="questionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ì§ˆë¬¸ ì¶”ê°€</h3>
                <button class="close-btn" onclick="closeQuestionModal()">Ã—</button>
            </div>
            <form id="questionForm" onsubmit="saveQuestion(event)">
                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬*</label>
                    <select id="questionCategory" required>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì§ˆë¬¸ ë‚´ìš©*</label>
                    <textarea id="questionText" required placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>
                <input type="hidden" id="questionId">
                <div class="controls">
                    <button type="submit" class="btn-success">ì €ì¥</button>
                    <button type="button" class="btn-secondary" onclick="closeQuestionModal()">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ ì¶”ê°€/í¸ì§‘ ëª¨ë‹¬ -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="categoryModalTitle">ì¹´í…Œê³ ë¦¬ ì¶”ê°€</h3>
                <button class="close-btn" onclick="closeCategoryModal()">Ã—</button>
            </div>
            <form id="categoryForm" onsubmit="saveCategory(event)">
                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬ ID* (ì˜ë¬¸, ìˆ«ì, ì–¸ë”ìŠ¤ì½”ì–´ë§Œ ê°€ëŠ¥)</label>
                    <input type="text" id="categoryId" required pattern="[a-zA-Z0-9_]+" placeholder="ì˜ˆ: personality">
                </div>
                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬ ì´ë¦„*</label>
                    <input type="text" id="categoryName" required placeholder="ì˜ˆ: ì¸ì„±/ê°€ì¹˜ê´€">
                </div>
                <input type="hidden" id="editingCategoryId">
                <div class="controls">
                    <button type="submit" class="btn-success">ì €ì¥</button>
                    <button type="button" class="btn-secondary" onclick="closeCategoryModal()">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- ì§‘ì¤‘ ëª¨ë“œ ì»¨í…Œì´ë„ˆ -->
    <div id="focusModeContainer">
        <div class="focus-controls-top">
            <select id="focusCategorySelect"></select>
            <button id="exitFocusBtn">ë‚˜ê°€ê¸°</button>
        </div>
        <div id="focus-question-text">
            ì§‘ì¤‘ ëª¨ë“œë¥¼ ì‹œì‘í•˜ë ¤ë©´ ì¤‘ì•™ì˜ ì›ì„ í´ë¦­í•˜ì„¸ìš”.
        </div>
        <div id="focus-circle"></div>
        <div id="focus-status-text"></div>
    </div>

<script>
    const defaultData = {
        categories: {
            basic: "ê¸°ë³¸ ì§ˆë¬¸",
            academic: "í•™ì—…/íƒêµ¬",
            personality: "ì¸ì„±/ê°€ì¹˜ê´€",
            department: "í•™ê³¼/ì§„ë¡œ",
            technical: "ì „ê³µ ê´€ë ¨"
        },
        questions: {
            basic: [
                "ê°„ë‹¨í•˜ê²Œ ìê¸°ì†Œê°œë¥¼ í•´ì£¼ì„¸ìš”.",
                "ìì‹ ì˜ ì¥ì ì„ êµ¬ì²´ì ì¸ ì‚¬ë¡€ì™€ í•¨ê»˜ ë§ì”€í•´ì£¼ì„¸ìš”.",
                "ìì‹ ì˜ ë‹¨ì ì€ ë¬´ì—‡ì´ê³ , ì´ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ ì–´ë–¤ ë…¸ë ¥ì„ í•˜ê³  ìˆë‚˜ìš”?",
                "ë³¸ ëŒ€í•™êµ, ë³¸ í•™ê³¼ì— ì§€ì›í•œ ë™ê¸°ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
                "ë§ˆì§€ë§‰ìœ¼ë¡œ í•˜ê³  ì‹¶ì€ ë§ì”€ì´ ìˆìœ¼ì‹ ê°€ìš”?",
            ],
            academic: [
                "ê³ ë“±í•™êµì—ì„œ ê°€ì¥ ì—´ì‹¬íˆ ê³µë¶€í•œ ê³¼ëª©ê³¼ ê·¸ ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
                "í•™ìƒë¶€ì—ì„œ ê°€ì¥ ì¸ìƒ ê¹Šì€ íƒêµ¬í™œë™ì„ ì†Œê°œí•´ì£¼ì„¸ìš”.",
                "íƒêµ¬í™œë™ì„ í•˜ë©´ì„œ ê°€ì¥ ì–´ë ¤ì› ë˜ ì ê³¼ ê·¹ë³µ ê³¼ì •ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.",
                "í•™ì—… ì„±ì ì´ ë‚®ì€ ê³¼ëª©ì´ ìˆë‹¤ë©´ ê·¸ ì´ìœ ì™€ ê°œì„  ë…¸ë ¥ì„ ë§ì”€í•´ì£¼ì„¸ìš”.",
                "ê³ êµ 3ë…„ê°„ ê°€ì¥ ì˜ë¯¸ ìˆì—ˆë˜ í™œë™(ì„±ì·¨)ì€ ë¬´ì—‡ì¸ê°€ìš”? ê·¸ ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
                "ìì‹ ë§Œì˜ í•™ìŠµ ë°©ë²•ì´ë‚˜ ì‹œê°„ ê´€ë¦¬ ë…¸í•˜ìš°ê°€ ìˆë‚˜ìš”?"
            ],
            personality: [
                "ë¦¬ë”ì‹­ì„ ë°œíœ˜í•œ ê²½í—˜ì´ ìˆë‚˜ìš”? êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”.",
                "íŒ€ í”„ë¡œì íŠ¸ì—ì„œ ë¦¬ë” ì—­í• ì„ ë§¡ì•˜ë˜ ê²½í—˜ì„ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”.",
                "ë¦¬ë”ì‹­ê³¼ íŒ”ë¡œì›Œì‹­ ì¤‘ ìì‹ ì€ ì–´ëŠ ìª½ì— ë” ê°€ê¹Œìš´ê°€ìš”?",
                "ê°ˆë“± ìƒí™©ì—ì„œ ì–´ë–»ê²Œ ëŒ€ì²˜í•˜ë‚˜ìš”? êµ¬ì²´ì ì¸ ì‚¬ë¡€ë¥¼ ë“¤ì–´ ì„¤ëª…í•´ì£¼ì„¸ìš”.",
                "íƒ€ì¸ê³¼ ì˜ê²¬ì´ ë‹¤ë¥¼ ë•Œ ì–´ë–»ê²Œ ì¡°ìœ¨í•˜ë‚˜ìš”?",
                "ëª¨ë‘  í™œë™ì— ì œëŒ€ë¡œ ì°¸ì—¬í•˜ì§€ ì•ŠëŠ” ì¹œêµ¬ê°€ ìˆë‹¤ë©´ ì–´ë–»ê²Œ í• ê±´ê°€ìš”?",
                "ì¹œêµ¬ê°€ ì–´ë ¤ì›€ì— ì²˜í–ˆì„ ë•Œ ë„ì™€ì¤€ ê²½í—˜ì´ ìˆë‚˜ìš”?",
                "ì‹¤íŒ¨í•œ ê²½í—˜ê³¼ ê·¸ë¡œë¶€í„° ë°°ìš´ ì ì„ ë§ì”€í•´ì£¼ì„¸ìš”.",
                "ì§€ê¸ˆê¹Œì§€ ì‚´ì•„ì˜¤ë©´ì„œ ê²ªì—ˆë˜ ê°€ì¥ í˜ë“¤ì—ˆë˜ ê²½í—˜ì€ ë¬´ì—‡ì´ê³  ì–´ë–»ê²Œ ê·¹ë³µí–ˆë‚˜ìš”?",
                "ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ì„ ë•Œ ì–´ë–»ê²Œ í•´ì†Œí•˜ë‚˜ìš”?",
                "ìƒˆë¡œìš´ í™˜ê²½ì— ì ì‘í•˜ëŠ” ìì‹ ë§Œì˜ ë°©ë²•ì´ ìˆë‚˜ìš”?",
                "ìµœê·¼ì— ì½ì€ ì±… ì¤‘ ê°€ì¥ ì¸ìƒ ê¹Šì—ˆë˜ ì±…ê³¼ ê·¸ ì´ìœ ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”.",
                "ì¡´ê²½í•˜ëŠ” ì¸ë¬¼ì´ ìˆë‹¤ë©´ ëˆ„êµ¬ì´ë©°, ê·¸ ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
                "ë´‰ì‚¬í™œë™ ì¤‘ ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” í™œë™ì´ ìˆë‚˜ìš”?",
                "ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê°€ì¹˜ê´€ì€ ë¬´ì—‡ì¸ê°€ìš”?"
            ],
            department: [
                "ëŒ€í•™ ì…í•™ í›„ ê°€ì¥ ë¨¼ì € í•˜ê³  ì‹¶ì€ ì¼ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                "ì…í•™ í›„ í•™ì—…ê³„íšì„ ë§í•´ì£¼ì„¸ìš”.",
                "10ë…„ í›„ ìì‹ ì˜ ëª¨ìŠµì€ ì–´ë–¨ ê²ƒ ê°™ë‚˜ìš”?",
                "ì¡¸ì—… í›„ ì§„ë¡œ ê³„íšì€ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?",
                "ì´ í•™ê³¼ì—ì„œ ê°€ì¥ ë“£ê³  ì‹¶ì€ ê³¼ëª©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                "ì´ í•™ê³¼ì— ì§€ì›í•˜ê¸° ìœ„í•´ ì–´ë–¤ ë…¸ë ¥ì„ í–ˆë‚˜ìš”?"
            ],
            technical: [],
        }
    };

    // ì „ì—­ ë³€ìˆ˜
    let categories = {};
    let questions = {};
    let answers = [];
    let currentQuestion = null;
    let isRecording = false;
    let recognition = null;
    let timerInterval = null;
    let seconds = 0;
    let editingQuestionId = null;
    let koreanVoice = null; // TTS ëª©ì†Œë¦¬ ì €ì¥ ë³€ìˆ˜

    // ì§‘ì¤‘ ëª¨ë“œ ê´€ë ¨ ì „ì—­ ë³€ìˆ˜
    let isInFocusMode = false;
    let focusState = 'idle'; // idle -> waiting -> listening -> processing
    const FOCUS_DELAY = 500;

    // ì´ˆê¸°í™”
    function init() {
        loadKoreanVoice(); // ìì—°ìŠ¤ëŸ¬ìš´ í•œêµ­ì–´ ëª©ì†Œë¦¬ ë¡œë“œ
        loadDataFromStorage();
        updateAllUIs();
        updateAnswerList();
        initSpeechRecognition();
        createFocusModeButton();
    }

    function createFocusModeButton() {
        const focusModeBtn = document.createElement('button');
        focusModeBtn.className = 'btn-secondary';
        focusModeBtn.textContent = 'ì§‘ì¤‘ ëª¨ë“œ';
        focusModeBtn.onclick = enterFocusMode;
        document.querySelector('.header').appendChild(focusModeBtn);
    }
    
    function loadKoreanVoice() {
        const setVoice = () => {
            const voices = window.speechSynthesis.getVoices();
            koreanVoice = voices.find(voice => voice.lang === 'ko-KR' && voice.name.includes('Online')) || 
                          voices.find(voice => voice.lang === 'ko-KR');
        };
        if (window.speechSynthesis.onvoiceschanged !== undefined) {
            window.speechSynthesis.onvoiceschanged = setVoice;
        }
        setVoice();
    }

    // --- ë°ì´í„° ê´€ë¦¬ ---
    function loadDataFromStorage() {
        const storedCategories = localStorage.getItem('interviewCategories');
        const storedQuestions = localStorage.getItem('interviewQuestions');
        const storedAnswers = localStorage.getItem('interviewAnswers');

        categories = storedCategories ? JSON.parse(storedCategories) : JSON.parse(JSON.stringify(defaultData.categories));
        questions = storedQuestions ? JSON.parse(storedQuestions) : JSON.parse(JSON.stringify(defaultData.questions));
        answers = storedAnswers ? JSON.parse(storedAnswers) : [];

        if (!storedCategories && !storedQuestions) {
            saveCategoriesToStorage();
            saveQuestionsToStorage();
        }
    }

    function saveCategoriesToStorage() { localStorage.setItem('interviewCategories', JSON.stringify(categories)); }
    function saveQuestionsToStorage() { localStorage.setItem('interviewQuestions', JSON.stringify(questions)); }
    function saveAnswersToStorage() { localStorage.setItem('interviewAnswers', JSON.stringify(answers)); }

    // --- UI ë Œë”ë§ ---
    function updateAllUIs() {
        renderCategoryManagement();
        renderQuestionAccordion();
        updateCategorySelectors();
        updateRecentAnswers();
        updateStats();
    }

    function renderCategoryManagement() {
        const container = document.getElementById('category-list-new');
        if (!container) return;
        
        container.innerHTML = Object.entries(categories).map(([id, name]) => `
            <div class="category-list-item">
                <div class="category-info-new">
                    <span class="category-name-badge">${id}</span>
                    <span>${name}</span>
                    <span class="question-count-badge">${(questions[id] || []).length}ê°œ ì§ˆë¬¸</span>
                </div>
                <div class="answer-actions">
                    <button class="btn-secondary btn-small" onclick='editCategory("${id}")'>ìˆ˜ì •</button>
                    <button class="btn-danger btn-small" onclick='deleteCategory("${id}")'>ì‚­ì œ</button>
                </div>
            </div>
        `).join('');
    }

    function renderQuestionAccordion() {
        const container = document.getElementById('question-accordion-list');
        if (!container) return;

        container.innerHTML = Object.entries(categories).map(([id, name]) => {
            const questionList = questions[id] || [];
            const questionsHtml = questionList.map((q, index) => `
                <div class="question-list-item">
                    <span class="question-number-new">${index + 1}.</span>
                    <span class="question-text-view">${q}</span>
                    <div class="answer-actions">
                        <button class="btn-secondary btn-small btn-icon" onclick='editQuestion("${id}", ${index})' title="ìˆ˜ì •">âœï¸</button>
                        <button class="btn-danger btn-small btn-icon" onclick='deleteQuestion("${id}", ${index})' title="ì‚­ì œ">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');

            return `
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)" data-category-id="${id}">
                        <div class="accordion-header-left">
                            <span class="toggle-icon">â–¶</span>
                            <span>${name}</span>
                            <span class="question-count-badge">${questionList.length}ê°œ</span>
                        </div>
                        <div class="accordion-header-right">
                             <button class="btn-secondary btn-small" onclick="event.stopPropagation(); exportCategory('${id}');">ë‚´ë³´ë‚´ê¸°</button>
                             <button class="btn-secondary btn-small" onclick="event.stopPropagation(); triggerCategoryImport('${id}');">ê°€ì ¸ì˜¤ê¸°</button>
                             <button class="btn-primary btn-small" onclick="event.stopPropagation(); openAddQuestionModal('${id}');">+</button>
                        </div>
                    </div>
                    <div class="accordion-content" id="content-${id}">
                        ${questionsHtml.length > 0 ? questionsHtml : '<p style="color: #6b7280; text-align: center; padding: 10px 0;">ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
                        <form class="inline-add-form" onsubmit="inlineAddQuestion(event, '${id}')">
                            <input type="text" placeholder="ìƒˆ ì§ˆë¬¸ì„ ì…ë ¥í•˜ê³  Enterë¥¼ ëˆ„ë¥´ì„¸ìš”..." required>
                        </form>
                    </div>
                </div>
            `;
        }).join('');
    }

    function toggleAccordion(headerElement) {
        headerElement.classList.toggle('active');
        const content = headerElement.nextElementSibling;
        content.style.display = content.style.display === "block" ? "none" : "block";
    }

    function inlineAddQuestion(event, categoryId) {
        event.preventDefault();
        const input = event.target.querySelector('input');
        const newQuestion = input.value.trim();
        if (newQuestion) {
            if (!questions[categoryId]) questions[categoryId] = [];
            questions[categoryId].push(newQuestion);
            saveQuestionsToStorage();
            updateAllUIs();
            input.value = '';
            const header = document.querySelector(`.accordion-header[data-category-id="${categoryId}"]`);
            if (header && !header.classList.contains('active')) toggleAccordion(header);
        }
    }

    // --- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ---
    function openAddCategoryModal() {
        document.getElementById('categoryModalTitle').textContent = 'ì¹´í…Œê³ ë¦¬ ì¶”ê°€';
        document.getElementById('categoryForm').reset();
        document.getElementById('categoryId').disabled = false;
        document.getElementById('editingCategoryId').value = '';
        document.getElementById('categoryModal').classList.add('active');
    }

    function editCategory(categoryId) {
        document.getElementById('categoryModalTitle').textContent = 'ì¹´í…Œê³ ë¦¬ í¸ì§‘';
        document.getElementById('categoryForm').reset();
        document.getElementById('categoryId').value = categoryId;
        document.getElementById('categoryId').disabled = true;
        document.getElementById('categoryName').value = categories[categoryId];
        document.getElementById('editingCategoryId').value = categoryId;
        document.getElementById('categoryModal').classList.add('active');
    }

    function closeCategoryModal() { document.getElementById('categoryModal').classList.remove('active'); }

    function saveCategory(event) {
        event.preventDefault();
        const categoryId = document.getElementById('categoryId').value.trim();
        const categoryName = document.getElementById('categoryName').value.trim();
        const oldCategoryId = document.getElementById('editingCategoryId').value;

        if (!categoryId || !categoryName) return;
        if (!oldCategoryId && categories[categoryId]) {
            alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì¹´í…Œê³ ë¦¬ IDì…ë‹ˆë‹¤.');
            return;
        }

        if (oldCategoryId) categories[oldCategoryId] = categoryName;
        else {
            categories[categoryId] = categoryName;
            if (!questions[categoryId]) questions[categoryId] = [];
        }
        saveCategoriesToStorage();
        saveQuestionsToStorage();
        updateAllUIs();
        closeCategoryModal();
    }

    function deleteCategory(categoryId) {
        const questionCount = (questions[categoryId] || []).length;
        const confirmMsg = questionCount > 0
            ? `ì´ ì¹´í…Œê³ ë¦¬ì—ëŠ” ${questionCount}ê°œì˜ ì§ˆë¬¸ì´ ìˆìŠµë‹ˆë‹¤. ì¹´í…Œê³ ë¦¬ì™€ í•¨ê»˜ ëª¨ë“  ì§ˆë¬¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
            : `'${categories[categoryId]}' ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
        if (confirm(confirmMsg)) {
            delete categories[categoryId];
            delete questions[categoryId];
            saveCategoriesToStorage();
            saveQuestionsToStorage();
            updateAllUIs();
        }
    }
    
    // --- ì§ˆë¬¸ ê´€ë¦¬ ---
    function openAddQuestionModal(categoryId = null) {
        editingQuestionId = null;
        document.getElementById('modalTitle').textContent = 'ì§ˆë¬¸ ì¶”ê°€';
        document.getElementById('questionForm').reset();
        document.getElementById('questionId').value = '';
        document.getElementById('questionCategory').value = categoryId || Object.keys(categories)[0] || '';
        document.getElementById('questionModal').classList.add('active');
    }

    function editQuestion(categoryId, index) {
        editingQuestionId = `${categoryId}-${index}`;
        document.getElementById('modalTitle').textContent = 'ì§ˆë¬¸ í¸ì§‘';
        document.getElementById('questionForm').reset();
        document.getElementById('questionCategory').value = categoryId;
        document.getElementById('questionText').value = questions[categoryId][index];
        document.getElementById('questionId').value = editingQuestionId;
        document.getElementById('questionModal').classList.add('active');
    }

    function closeQuestionModal() { document.getElementById('questionModal').classList.remove('active'); }

    function saveQuestion(event) {
        event.preventDefault();
        const categoryId = document.getElementById('questionCategory').value;
        const text = document.getElementById('questionText').value.trim();
        const questionId = document.getElementById('questionId').value;

        if (!text) return;
        if (!questions[categoryId]) questions[categoryId] = [];

        if (questionId) {
            const [oldCategoryId, index] = questionId.split('-');
            if (oldCategoryId === categoryId) questions[oldCategoryId][parseInt(index)] = text;
            else {
                questions[oldCategoryId].splice(parseInt(index), 1);
                questions[categoryId].push(text);
            }
        } else {
            questions[categoryId].push(text);
        }
        saveQuestionsToStorage();
        updateAllUIs();
        closeQuestionModal();
    }

    function deleteQuestion(categoryId, index) {
        questions[categoryId].splice(index, 1);
        saveQuestionsToStorage();
        updateAllUIs();
    }

    // --- ë°ì´í„° ê´€ë¦¬ (ì „ì²´/ì¹´í…Œê³ ë¦¬ë³„) ---
    function exportDatabase() {
        const data = { categories, questions };
        const dataStr = JSON.stringify(data, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `interview_db_all_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
    }

    function importDatabase(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const data = JSON.parse(e.target.result);
                if (data.categories && data.questions) {
                    if (confirm('ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ ê¸°ì¡´ ì§ˆë¬¸ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì™„ì „íˆ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        categories = data.categories;
                        questions = data.questions;
                        saveCategoriesToStorage();
                        saveQuestionsToStorage();
                        updateAllUIs();
                        alert('ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.');
                    }
                } else { alert('ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.'); }
            } catch (error) { alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); }
        };
        reader.readAsText(file);
        event.target.value = '';
    }
    
    function exportCategory(categoryId) {
        const categoryQuestions = questions[categoryId] || [];
        const dataStr = JSON.stringify(categoryQuestions, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `questions_${categoryId}_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
    }

    function triggerCategoryImport(categoryId) {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = (event) => importCategory(event, categoryId);
        input.click();
    }

    function importCategory(event, categoryId) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const importedQuestions = JSON.parse(e.target.result);
                if (Array.isArray(importedQuestions)) {
                    if (!questions[categoryId]) questions[categoryId] = [];
                    const originalCount = questions[categoryId].length;
                    questions[categoryId] = [...new Set([...questions[categoryId], ...importedQuestions])];
                    const addedCount = questions[categoryId].length - originalCount;
                    saveQuestionsToStorage();
                    updateAllUIs();
                    alert(`'${categories[categoryId]}' ì¹´í…Œê³ ë¦¬ì— ${addedCount}ê°œì˜ ìƒˆ ì§ˆë¬¸ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`);
                } else { alert('ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ ì§ˆë¬¸ íŒŒì¼(ì§ˆë¬¸ ëª©ë¡ ë°°ì—´)ì´ ì•„ë‹™ë‹ˆë‹¤.'); }
            } catch (error) { alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); }
        };
        reader.readAsText(file);
    }

    // --- ìŒì„± ì¸ì‹ (ê³ ê¸‰ ë²„ì „) ---
    function initSpeechRecognition() {
        if (window.location.protocol === 'file:') {
            document.getElementById('setupWarning').style.display = 'block';
            return;
        }
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            try {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'ko-KR';
                recognition.maxAlternatives = 1;
                let finalTranscript = '';

                recognition.onstart = () => {
                    finalTranscript = document.getElementById('transcriptionText').value;
                     if (finalTranscript.length > 0 && !finalTranscript.endsWith(' ')) finalTranscript += ' ';
                    showRecognitionStatus('ìŒì„± ì¸ì‹ í™œì„±í™” - ë§ì”€í•´ì£¼ì„¸ìš”', '#7c9473', 'â—');
                };

                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript + ' ';
                        } else {
                            interimTranscript += transcript;
                        }
                    }
                    document.getElementById('transcriptionText').value = finalTranscript + interimTranscript;
                    if (interimTranscript) showRecognitionStatus(`ğŸ”Š ì¸ì‹ ì¤‘...`, '#3b82f6', 'â—');
                };

                recognition.onerror = (event) => {
                    let errorMsg = 'ìŒì„± ì¸ì‹ ì˜¤ë¥˜';
                    switch(event.error) {
                        case 'network': errorMsg = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.'; break;
                        case 'not-allowed': errorMsg = 'ë§ˆì´í¬ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.'; break;
                        case 'no-speech': errorMsg = 'ìŒì„±ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'; break;
                        case 'audio-capture': errorMsg = 'ë§ˆì´í¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'; break;
                    }
                    showStatus(errorMsg, 'error');
                    showRecognitionStatus(errorMsg, '#ef4444', '!');
                    stopRecording();
                };

                recognition.onend = () => {
                    if (isRecording) {
                        try { recognition.start(); }
                        catch (e) { stopRecording(); showRecognitionStatus('âš ï¸ ì¬ì‹œì‘ ì‹¤íŒ¨', '#ef4444', '!'); }
                    } else {
                        showRecognitionStatus('ìŒì„± ì¸ì‹ ëŒ€ê¸° ì¤‘', '#6b7280', 'â—‹');
                    }
                };
                showRecognitionStatus('ìŒì„± ì¸ì‹ ì¤€ë¹„ ì™„ë£Œ', '#10b981', 'âœ“');
            } catch (e) {
                showStatus('ìŒì„± ì¸ì‹ì„ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                showRecognitionStatus('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨', '#ef4444', '!');
            }
        } else {
            showStatus('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
            showRecognitionStatus('âŒ ë¸Œë¼ìš°ì € ë¯¸ì§€ì›', '#ef4444', '!');
        }
    }

    function showRecognitionStatus(message, color, icon) {
        const statusBar = document.getElementById('recognitionStatusBar');
        const statusText = document.getElementById('recognitionStatusText');
        const statusIcon = document.getElementById('recognitionStatusIcon');
        
        if (statusBar) {
            statusBar.style.display = 'block';
            const wrapper = statusBar.querySelector('div');
            wrapper.style.backgroundColor = color + '20';
            wrapper.style.borderColor = color;
            statusText.textContent = message;
            statusText.style.color = color;
            statusIcon.textContent = icon;
            statusIcon.style.color = color;
        }
    }

    function toggleRecording() {
        if (!recognition) {
            showStatus('ìŒì„± ì¸ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
            return;
        }
        if (!currentQuestion) {
            showStatus('ë¨¼ì € ì§ˆë¬¸ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        if (isRecording) stopRecording();
        else startRecording();
    }

    function startRecording() {
        try {
            recognition.start();
            isRecording = true;
            if (!isInFocusMode) {
                document.getElementById('recordBtn').textContent = 'ë…¹ìŒ ì¤‘ì§€';
                document.getElementById('recordBtn').classList.add('recording');
                startTimer();
                showStatus('ë…¹ìŒ ì¤‘... ë‹µë³€ì„ ì‹œì‘í•˜ì„¸ìš”.', 'info');
            }
        } catch (e) {
            showStatus('ë…¹ìŒì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í…ìŠ¤íŠ¸ë¡œ ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            isRecording = false;
        }
    }

    function stopRecording() {
        if (recognition && isRecording) {
            isRecording = false;
            recognition.stop();
        } else {
            isRecording = false;
        }
        if (!isInFocusMode) {
            document.getElementById('recordBtn').textContent = 'ë…¹ìŒ ì‹œì‘';
            document.getElementById('recordBtn').classList.remove('recording');
            stopTimer();
            if (document.getElementById('transcriptionText').value.trim()) {
                showStatus('ë…¹ìŒì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹µë³€ì„ í™•ì¸í•˜ê³  ì €ì¥í•˜ì„¸ìš”.', 'success');
            }
        }
    }

    // --- ê¸°íƒ€ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
    function switchTab(tabName) {
        document.querySelectorAll('.tab.active, .tab-content.active').forEach(el => el.classList.remove('active'));
        const clickedTab = Array.from(document.querySelectorAll('.tab')).find(tab => tab.getAttribute('onclick').includes(`'${tabName}'`));
        if(clickedTab) clickedTab.classList.add('active');
        document.getElementById(tabName + '-tab').classList.add('active');
        if (tabName === 'answers') updateAnswerList();
        updateAllUIs();
    }
    
    function updateCategorySelectors() {
        const selectors = [document.getElementById('categorySelect'), document.getElementById('questionCategory')];
        const categoryOptions = Object.entries(categories).map(([id, name]) => `<option value="${id}">${name}</option>`).join('');
        selectors.forEach(selector => {
            if (selector) {
                const currentVal = selector.value;
                selector.innerHTML = selector.id === 'categorySelect' ? '<option value="all">ì „ì²´</option>' + categoryOptions : categoryOptions;
                selector.value = currentVal;
            }
        });
    }

    function startTimer() {
        if (timerInterval) return;
        timerInterval = setInterval(() => {
            seconds++;
            updateTimerDisplay();
        }, 1000);
    }

    function stopTimer() {
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = null;
    }

    function resetTimer() {
        stopTimer();
        seconds = 0;
        updateTimerDisplay();
    }

    function updateTimerDisplay() {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        document.getElementById('timer').textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }

    function getNewQuestion() {
        const category = document.getElementById('categorySelect').value;
        const availableQuestions = category === 'all' ? Object.values(questions).flat() : questions[category] || [];
        if (availableQuestions.length === 0) {
            showStatus('ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ì— ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
            currentQuestion = null;
            document.getElementById('questionDisplay').innerHTML = `<div class="question-number">ì§ˆë¬¸ ì—†ìŒ</div><div class="question-text">ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ì— ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
            return;
        }
        currentQuestion = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
        document.getElementById('questionDisplay').innerHTML = `<div class="question-number">ì§ˆë¬¸ (${getQuestionCategory(currentQuestion, true)})</div><div class="question-text">${currentQuestion}</div>`;
        resetTimer();
        clearTranscription();
    }

    function getQuestionCategory(question, returnName = false) {
        for (const [categoryId, questionList] of Object.entries(questions)) {
            if (questionList.includes(question)) return returnName ? (categories[categoryId] || categoryId) : categoryId;
        }
        return returnName ? 'ê¸°íƒ€' : 'unknown';
    }

    function saveAnswer() {
        const transcription = document.getElementById('transcriptionText').value.trim();
        if (!currentQuestion) {
            if (!isInFocusMode) showStatus('ì§ˆë¬¸ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        if (!transcription) {
            if (!isInFocusMode) showStatus('ë‹µë³€ ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.', 'error');
            return;
        }
        const answer = {
            id: Date.now(),
            question: currentQuestion,
            answer: transcription,
            duration: seconds,
            timestamp: new Date().toISOString(),
            category: getQuestionCategory(currentQuestion, true)
        };
        answers.unshift(answer);
        saveAnswersToStorage();
        updateAllUIs();
        if (!isInFocusMode) {
            showStatus('ë‹µë³€ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }
        clearTranscription();
        resetTimer();
    }

    function clearTranscription() { document.getElementById('transcriptionText').value = ''; }

    function updateRecentAnswers() {
        const container = document.getElementById('recentAnswers');
        const recent = answers.slice(0, 5);
        if (recent.length === 0) {
            container.innerHTML = '<div class="empty-state"><p>ì•„ì§ ì €ì¥ëœ ë‹µë³€ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
            return;
        }
        container.innerHTML = recent.map(answer => `
            <div class="answer-card">
                <div class="answer-question">${answer.question}</div>
                <div class="answer-meta">${answer.category} | ${Math.floor(answer.duration / 60)}ë¶„ ${answer.duration % 60}ì´ˆ</div>
            </div>
        `).join('');
    }

    function updateAnswerList() {
        const container = document.getElementById('answerList');
        const searchTerm = document.getElementById('answerSearch')?.value.toLowerCase() || '';
        const filtered = answers.filter(a => !searchTerm || a.question.toLowerCase().includes(searchTerm) || a.answer.toLowerCase().includes(searchTerm));
        if (filtered.length === 0) {
            container.innerHTML = '<div class="empty-state"><p>ì €ì¥ëœ ë‹µë³€ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
            return;
        }
        container.innerHTML = filtered.map(answer => `
            <div class="answer-card">
                <div class="answer-question">${answer.question}</div>
                <div class="answer-meta">ì¹´í…Œê³ ë¦¬: ${answer.category} | ì‹œê°„: ${Math.floor(answer.duration / 60)}ë¶„ ${answer.duration % 60}ì´ˆ | ${new Date(answer.timestamp).toLocaleString('ko-KR')}</div>
                <div class="answer-text">${answer.answer.replace(/\n/g, '<br>')}</div>
                <div class="answer-actions"><button class="btn-danger btn-small" onclick="deleteAnswer(${answer.id})">ì‚­ì œ</button></div>
            </div>
        `).join('');
    }

    function filterAnswers() { updateAnswerList(); }

    function deleteAnswer(id) {
        if (confirm('ì´ ë‹µë³€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            answers = answers.filter(a => a.id !== id);
            saveAnswersToStorage();
            updateAnswerList();
            updateAllUIs();
            showStatus('ë‹µë³€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
    }

    function clearAllAnswers() {
        if (answers.length > 0 && confirm('ëª¨ë“  ë‹µë³€ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
            answers = [];
            saveAnswersToStorage();
            updateAnswerList();
            updateAllUIs();
            showStatus('ëª¨ë“  ë‹µë³€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
    }

    function exportAnswers() {
        if (answers.length === 0) {
            showStatus('ë‚´ë³´ë‚¼ ë‹µë³€ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
            return;
        }
        const dataStr = JSON.stringify(answers, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `interview-answers-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
    }

    function importAnswers(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const imported = JSON.parse(e.target.result);
                if (!Array.isArray(imported)) throw new Error("Invalid format");
                if (confirm('ê¸°ì¡´ ë‹µë³€ì„ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ? (ì·¨ì†Œí•˜ë©´ ê¸°ì¡´ ë‹µë³€ì— ì¶”ê°€ë©ë‹ˆë‹¤)')) answers = imported;
                else answers = [...answers, ...imported];
                saveAnswersToStorage();
                updateAnswerList();
                updateAllUIs();
                showStatus(`${imported.length}ê°œì˜ ë‹µë³€ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`, 'success');
            } catch (error) { showStatus('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error'); }
        };
        reader.readAsText(file);
        event.target.value = '';
    }

    function updateStats() {
        const totalQuestions = Object.values(questions).reduce((sum, list) => sum + list.length, 0);
        const categoryCount = Object.keys(categories).length;
        const totalAnswers = answers.length;
        const totalTime = answers.reduce((sum, a) => sum + a.duration, 0);
        const stats = {
            statsQuestionsCount: totalQuestions,
            statsCategoryCount: categoryCount,
            statsAnswersCount: totalAnswers,
            statsPracticeTime: Math.round(totalTime / 60),
        };
        for (const [id, value] of Object.entries(stats)) {
            const el = document.getElementById(id);
            if (el) el.textContent = value;
        }
    }

    function showStatus(message, type) {
        const statusDiv = document.getElementById('statusMessage');
        statusDiv.className = `status-message status-${type}`;
        statusDiv.textContent = message;
        setTimeout(() => {
            statusDiv.textContent = '';
            statusDiv.className = '';
        }, 5000);
    }

    // --- ì§‘ì¤‘ ëª¨ë“œ ê´€ë ¨ í•¨ìˆ˜ë“¤ ---
    function enterFocusMode() {
        const container = document.getElementById('focusModeContainer');
        container.classList.add('active');
        isInFocusMode = true;

        const mainCategorySelect = document.getElementById('categorySelect');
        const focusCategorySelect = document.getElementById('focusCategorySelect');
        focusCategorySelect.innerHTML = mainCategorySelect.innerHTML;
        focusCategorySelect.value = mainCategorySelect.value;
        
        resetFocusMode();
        clearTranscription();
    }

    function exitFocusMode() {
        if (isRecording) stopRecording();
        const container = document.getElementById('focusModeContainer');
        container.classList.remove('active');
        isInFocusMode = false;
        resetFocusMode();
    }
    document.getElementById('exitFocusBtn').addEventListener('click', exitFocusMode);

    function resetFocusMode() {
        focusState = 'idle';
        document.getElementById('focus-question-text').textContent = 'ì§‘ì¤‘ ëª¨ë“œë¥¼ ì‹œì‘í•˜ë ¤ë©´ ì¤‘ì•™ì˜ ì›ì„ í´ë¦­í•˜ì„¸ìš”.';
        document.getElementById('focus-status-text').textContent = '';
        const circle = document.getElementById('focus-circle');
        circle.classList.remove('waiting', 'listening');
    }

    function speak(text, callback) {
        if (!('speechSynthesis' in window)) {
            alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± í•©ì„±ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            if (callback) callback();
            return;
        }
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        if (koreanVoice) {
            utterance.voice = koreanVoice;
        }
        utterance.lang = 'ko-KR';
        utterance.rate = 1.0;
        utterance.onend = () => {
            if (callback) callback();
        };
        window.speechSynthesis.speak(utterance);
    }

    function startFocusModeQuestion() {
        if (focusState !== 'idle') return;
        clearTranscription();
        resetTimer();

        const category = document.getElementById('focusCategorySelect').value;
        const availableQuestions = category === 'all' ? Object.values(questions).flat() : questions[category] || [];
        if (availableQuestions.length === 0) {
            document.getElementById('focus-question-text').textContent = 'ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ì— ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.';
            return;
        }
        currentQuestion = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
        document.getElementById('focus-question-text').textContent = currentQuestion;

        focusState = 'waiting';
        document.getElementById('focus-status-text').textContent = 'ì§ˆë¬¸ì„ ë“¤ì–´ë³´ì„¸ìš”...';
        
        speak(currentQuestion, () => {
            const circle = document.getElementById('focus-circle');
            circle.classList.add('waiting');
            document.getElementById('focus-status-text').textContent = 'ë‹µë³€ì„ ì¤€ë¹„í•˜ì„¸ìš”...';
            startTimer();

            setTimeout(() => {
                circle.classList.remove('waiting');
                circle.classList.add('listening');
                document.getElementById('focus-status-text').textContent = 'ë“£ê³  ìˆìŠµë‹ˆë‹¤...';
                startRecording();
                focusState = 'listening';
            }, FOCUS_DELAY);
        });
    }

    function stopAndSaveAnswer() {
        if (focusState !== 'listening') return;
        
        focusState = 'processing';
        document.getElementById('focus-status-text').textContent = 'ë‹µë³€ì„ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...';
        
        stopTimer();
        stopRecording();

        setTimeout(() => {
            saveAnswer();
            document.getElementById('focus-status-text').textContent = 'ë‹µë³€ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ ì›ì„ í´ë¦­í•˜ì„¸ìš”.';
            focusState = 'idle';
            document.getElementById('focus-circle').classList.remove('listening');
        }, 1000);
    }

    document.getElementById('focus-circle').addEventListener('click', () => {
        if (focusState === 'idle') {
            startFocusModeQuestion();
        } else if (focusState === 'listening') {
            stopAndSaveAnswer();
        }
    });

    document.addEventListener('DOMContentLoaded', init);
    document.querySelectorAll('.modal').forEach(modal => modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('active'); }));
</script>
</body>
</html>
